{% extends "base/base.html" %}

{% block content %}
    {% for goods in goods_list %}
        <hr>
        <a href="{% url "goods:goods_update" goods.id %}">{{ goods }}</a> <br>
        [{{ goods.entertainer}}] - {{ goods.category }} <br>
        creator : {{ goods.creator }} <br>
        description : {{ goods.description }} <br>
        <button onclick="sendRequest({{ goods.id }}, this)">{% if user.nickname in goods.like_list %}Unlike{% else %}Like{% endif %}</button>: <span id="like_count">{{ goods.like_count }}</span> <br>
        design : <br>
        {% for design in goods.design.all %}
            <img src="/media/{{ design.design }}" alt="">
        {% endfor %}
        <form action="{% url "goods:goods_delete" goods.id %}" method="post">
            {% csrf_token %}
            <input type="submit" value="Delete">
        </form>
    {% endfor %}
    <a href="{% url "goods:goods_create" %}">Add</a>

    <script>
        function sendRequest(bid, event) {
            var httpRequest = new XMLHttpRequest();
            var like_count = document.getElementById("like_count");
            httpRequest.onreadystatechange = function() {
                if (httpRequest.readyState == XMLHttpRequest.DONE && httpRequest.status == 200) {
                    console.log(httpRequest.responseText);

                    var json_data = JSON.parse(httpRequest.responseText);
                    if (json_data["message"]=="unlike") {
                        event.innerText = "Unlike";
                        like_count.innerText = json_data["count"]
                    } else {
                        event.innerText = "Like";
                        like_count.innerText = json_data["count"]
                    }
                }
            };

            httpRequest.open("GET", bid+"/like/", true);
            httpRequest.send();
        }
    </script>
{% endblock content %}